!function(t){var e={};function a(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},a.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";a.r(e);const n={apiKey:"AIzaSyCTSrtpza1D_7tv0w82CV6cd6bqMabvGb8",authDomain:"test-po4erk.firebaseapp.com",databaseURL:"https://test-po4erk.firebaseio.com",projectId:"test-po4erk",storageBucket:"test-po4erk.appspot.com",messagingSenderId:"950069581603"};class o{constructor(){}get auth(){return firebase.auth()}get database(){return firebase.database()}get storage(){return firebase.storage()}init(){firebase.initializeApp(n)}}class s{constructor(){this.firebase=new o,this.name="Fastfoods"}init(){this.base=this.firebase.database.ref(this.name),this.storage=this.firebase.storage}loadTable(t){this.base.on("child_added",function(e){let a=e.key,n=[e.child("name").val(),e.child("address").val(),e.child("rating").val()],o=t.rows.add([n]).draw().nodes();$(o).attr("data-key",a)})}addNew(t,e){this.base.push({name:t,address:e,rating:"Any rating",info:"Any info"}).then(function(){setTimeout(function(){$(".alert-success").fadeOut("slow")},1500),$(".alert-success").text("Place added!").fadeIn("slow")}).catch(function(t){setTimeout(function(){$(".alert-danger").fadeOut("slow")},2e3),$(".alert-danger").text("Place was not added!").fadeIn("slow")})}deleteData(t){this.storage.ref(t).delete().then(function(){console.log("Delete image complite!")}).catch(function(t){console.log("Delete image error!")}),this.base.child(t).remove().then(function(){setTimeout(function(){$(".alert-success").fadeOut("slow")},1500),$(".alert-success").text("Place deleted!").fadeIn("slow")}).catch(function(t){setTimeout(function(){$(".alert-danger").fadeOut("slow")},2e3),$(".alert-danger").text("Place was not deleted!").fadeIn("slow")})}}class i{constructor(){this.dao=new s,this.router=new m}init(){const t=$("#dataTable").DataTable({autoWidth:!1,destroy:!0,columnDefs:[{width:"3%",targets:3,data:null,defaultContent:"<button type='button' class='btn btn-danger delete'>Delete</button>"},{width:"3%",targets:4,data:null,defaultContent:"<button type='button' class='btn btn-info edit'>Show More</button>"}]});this.dao.init(),this.dao.loadTable(t),$("#addAdd").on("click",()=>{let t=$("#newName").val(),e=$("#newAddress").val();""==t||""==e?dialog.alert({title:"Sorry!",message:"You must enter name and address!"}):(this.dao.addNew(t,e),t=$("#newName").val(""),e=$("#newAddress").val(""))}),$("#dataTable tbody").on("click",".delete",e=>{let a=$(e.target),n=a.parent().parent().attr("data-key");dialog.confirm({title:"Delete place",message:"Do you want delete this place?",cancel:"Cancel",button:"Accept",required:!0,callback:e=>{if(1!=e)return!1;this.dao.deleteData(n),t.rows(a.parents("tr")).remove().draw()}})}),$("#btnLogOut").on("click",t=>{console.log("logout"),dialog.confirm({title:"Logout",message:"Do you want to exit?",cancel:"No",button:"Yes",required:!0,callback:t=>{if(1!=t)return!1;this.dao.firebase.auth.signOut(),this.router.navigate("#!login")}})}),$("#dataTable tbody").on("click",".edit",t=>{let e=$(t.target).parent().parent().attr("data-key");this.router.navigate(`show/${e}`)})}}class l{constructor(){this.firebase=new o,this.name="Fastfoods"}init(){this.base=this.firebase.database.ref(this.name),this.storage=this.firebase.storage}getShowData(t){return this.base.child(t).once("value").then(t=>{return{title:t.child("name").val(),address:t.child("address").val(),info:t.child("info").val(),rating:t.child("rating").val()}})}getShowComments(t){return this.base.child(t+"/comments").once("value").then(t=>t.val())}uploadImage(t,e){let a=t.files[0];this.storage.ref(e).put(a).on("state_changed",t=>{let e=t.bytesTransferred/t.totalBytes*100;$("#uploader").val(e)},t=>{console.log("Upload image for this place.")},()=>{console.log("Image uploaded!"),$(".image").attr("src",""),this.downloadImage(e)})}downloadImage(t){return this.storage.ref(t).getDownloadURL().then(t=>{$(".image").attr("src",t)}).catch(t=>console.error("Image does not exist!"))}rating(t,e){console.log(e);let a,n=0;for(let t=0;t<e.length;t++)a=(n+=+e[t])/e.length;let o=Math.floor(a);console.log(o),this.editDataRating(t,o),$("[data-key="+t+"] td:eq(2)").html(o)}editDataName(t,e){this.base.child(t).update({name:e})}editDataAddress(t,e){this.base.child(t).update({address:e})}editDataInfo(t,e){this.base.child(t).update({info:e})}editDataRating(t,e){this.base.child(t).update({rating:e})}addNewComment(t,e,a,n){this.base.child(t+"/comments").push({name:e,comment:a,rating:n})}deleteNewComment(t,e){this.base.child(t+"/comments/"+e).remove()}}class r{constructor(){this.router=new m,this.actions=new l}showMore(){const t=$("#dataKey").val();this.actions.init(),this.actions.getShowData(t).then(t=>{let e=$("#template").html(),a=Handlebars.compile(e)(t);$("#result").html(a)}).then(()=>this.actions.downloadImage(t)).then(()=>{$(".title").on("click",e=>{dialog.prompt({title:"New Name",message:"Enter new name",button:"Submit",input:{type:"text",placeholder:"New name..."},validate:e=>{if(""===$.trim(e))return!1;this.actions.editDataName(t,e),$(".title").html(e),$("[data-key="+t+"] td:eq(0)").html(e)}})}),$("#Address").geocomplete({map:"#map"}),$("#Address").trigger("geocode"),$(".address").on("click",t=>{$(".address").addClass("hide"),$("#Address").removeClass("hide")}),$("#Address").on("keypress",e=>{e=e||window.event;let a=$("#Address").val();if(13===e.keyCode){if(""===$.trim(a))return!1;this.actions.editDataAddress(t,a),$(".address").html(a),$("[data-key="+t+"] td:eq(1)").html(a),$("#Address").addClass("hide"),$(".address").removeClass("hide")}}),$(".info").on("click",e=>{dialog.prompt({title:"New Info about place",message:"Enter new info about this place",button:"Submit",input:{type:"text",placeholder:"New info..."},validate:e=>{if(""===$.trim(e))return!1;this.actions.editDataInfo(t,e),$(".info").html(e)}})}),$("#fileButton").on("change",e=>{let a=e.target;this.actions.uploadImage(a,t)}),$("#comments").on("click",e=>{$("#comments-wrapper").toggle(),$("#commentaries").toggle(),$("#commentaries").empty(),this.seeComment(t)}),$("#comments-button").on("click",e=>{let a=$("#comments-name").val(),n=$(".comments-area").val(),o=$("#ratingSel").val();""==a||""==n||"Rating:"==o?dialog.alert({title:"Fields not filled!",message:"You must fill in all fields!"}):(this.actions.addNewComment(t,a,n,o),dialog.alert({title:"Thanks!",message:"Your comment has been sent successfully!"}),$("#comments-name").val(""),$(".comments-area").val(""),$("#commentaries").html(""),this.seeCommentAndUpdateRating(t))}),$("#commentaries").on("click",".comDelete",e=>{let a=event.target.getAttribute("data-comment"),n=$(event.target).parent();dialog.confirm({title:"Delete comment",message:"Do you want delete this comment?",cancel:"Cancel",button:"Accept",required:!0,callback:e=>{if(!0!==e)return!1;n.remove(),this.actions.deleteNewComment(t,a),$("#commentaries").html(""),this.seeCommentAndUpdateRating(t)}})})}),$("#content").on("click","#Close",t=>{$("#fileButton").val(""),$("#uploader").attr("value","0"),this.router.navigate("app")})}seeCommentAndUpdateRating(t){let e=[];this.seeComment(t,e).then(()=>{this.actions.rating(t,e)})}seeComment(t,e){return e||(e=[]),this.actions.getShowComments(t).then(t=>{for(const a in t){const{name:n,comment:o,rating:s}=t[a];e.push(s);let i=$("#comTemplate").html(),l=Handlebars.compile(i)({comments:[{key:a,name:n,comment:o,rating:s}]});$("#commentaries").append(l)}})}}class d{constructor(){this.firebase=new o,this.router=new Router}logInGoogle(){let t=new firebase.auth.GoogleAuthProvider;this.firebase.auth.signInWithPopup(t).then(()=>this.router.navigate("app"))}logInAnon(){this.firebase.auth.signInAnonymously().then(()=>{console.log("You are logged in anonymously."),this.router.navigate("app")})}logIn(t,e){this.email=t,this.pass=e,this.firebase.auth.signInWithEmailAndPassword(t,e).then(()=>{console.log("You are logged in."),this.router.navigate("app")}).catch(function(a){""==t||""==e?dialog.alert({title:"Sorry!",message:"Enter any login data!"}):dialog.alert({title:"Sorry!",message:"Sign Up please!"})})}signUp(t,e){this.email=t,this.pass=e,this.firebase.auth.createUserWithEmailAndPassword(t,e).then(()=>{dialog.alert({title:"Thanks!",message:"Thanks for registration!"}),this.router.navigate("app")}).catch(t=>dialog.alert({title:"Sorry!",message:"The email address is badly formatted!"}))}}class c{constructor(){this.authorization=new d}init(){$("#btnLogIn").on("click",t=>{const e=$("#txtEmail").val(),a=$("#txtPassword").val();this.authorization.logIn(e,a)}),$("#btnLogInAnon").on("click",t=>{console.log("anon"),this.authorization.logInAnon()}),$("#btnLogInGoogle").on("click",t=>{this.authorization.logInGoogle()}),$("#btnSignUp").on("click",t=>{const e=$("#txtEmail").val(),a=$("#txtPassword").val();this.authorization.signUp(e,a)})}}let h=null;class m{constructor(){if(h)return h;h=this,this.router=new Navigo(null,!0,"#!")}loadHTML(t,e){return fetch(t).then(t=>t.text()).then(t=>$(e).html(t))}addNewRoute(){this.app=new i,this.loadHTML("./templates/app.html","#content").then(()=>this.loadHTML("./templates/add.html","#addBlock")).then(()=>this.app.init())}appRoute(){this.app=new i,this.loadHTML("./templates/app.html","#content").then(()=>this.app.init())}showRoute(t){this.app=new i,this.show=new r,this.loadHTML("./templates/app.html","#content").then(()=>this.app.init()).then(()=>{let e=document.createElement("input");e.id="dataKey",e.type="hidden",$("#content").append(e),$("#dataKey").val(`${t.key}`)}).then(()=>this.loadHTML("./templates/show.html","#addBlock")).then(()=>this.show.showMore())}loginRoute(){this.authView=new c,this.loadHTML("./templates/login.html","#content").then(()=>this.authView.init())}init(){this.router.on({addnew:()=>this.addNewRoute(),app:()=>this.appRoute(),"show/:key":t=>this.showRoute(t),login:()=>this.loginRoute(),"":()=>this.appRoute()}).resolve()}navigate(t){this.router.navigate(t)}}(new class{constructor(){this.firebase=new o,this.router=new m}init(){this.firebase.init(),this.router.init(),this.firebase.auth.onAuthStateChanged(t=>{t||this.router.navigate("login")})}}).init()}]);